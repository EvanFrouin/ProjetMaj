{% extends "base.html" %}
{% block style %}{{ url_for('static', filename='style/pageContent.css') }}{% endblock %}
{% block title %}Search{% endblock %}
{% block content %}
	<form id="queryForm" method="post" action={{ url_for("main.search") }}>
    	<div class="container">
    		<i id="queryButton" class="bi bi-search"></i>
			<input name="query" class="text-centered rounded" type="text" placeholder="Search engine ...">
		</div>
	</form>
    <div class="container">
		{% if request.method == "GET" %}
			<p>Entrez votre recherche.</p>
        {% elif results %}
 			{% for patient in results %}
				<p id="{{ patient.pk }}" onclick="getPatientData(this.id)">{{ patient.name }} {{ patient.surname }}</p>
			{% endfor %}
		{% else %}
			<p>Pas de r√©sultat pour cette recherche.</p>
		{% endif %}
     </div>
	<script type="text/javascript">
		let sio = io();

		document.getElementById("queryButton").onclick = () => { document.getElementById("queryForm").submit(); };

		function setCookie(cookieValue, minutesValid) {
  			let d = new Date();
  			d.setTime(d.getTime() + (minutesValid * 60 * 1000));
  			let expires = "expires="+ d.toUTCString();
  			document.cookie = "LastPatient=" + cookieValue + ";" + expires + ";path={{ url_for('main.profile') }}";
		}

		function getPatientData(id) {
			sio.emit('patient-id', id);
		}

		sio.on('patient-data', (data) => {
				setCookie(data, 10);
				location.replace("{{ url_for('main.profile') }}")
		});

	</script>
{% endblock %}
