{% extends "base.html" %}
{% block title %}Index{% endblock %}
{% block content %}
    <div>
        <canvas id="chart"></canvas>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js" integrity="sha512-q/dWJ3kcmjBLU4Qc47E4A9kTB4m3wuTY7vkFJDTZKjTs8jhyGQnaUrxa0Ytd0ssMZhbNua9hE+E7Qv1j+DyZwA==" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
	<script type="text/javascript" charset="utf-8">
		let socket = io();

		let count = 1;

		let width, height, gradient;
		function getGradient(ctx, chartArea) {
			const chartWidth = chartArea.right - chartArea.left;
		  	const chartHeight = chartArea.bottom - chartArea.top;
		  	if (gradient === null || width !== chartWidth || height !== chartHeight) {
		    		width = chartWidth;
		    		height = chartHeight;
		    		gradient = ctx.createLinearGradient(0, chartArea.bottom, 0, chartArea.top);
		    		gradient.addColorStop(0, 'rgb(0, 82, 100)');
		    		gradient.addColorStop(0.5, 'rgb(233, 189, 21)');
		    		gradient.addColorStop(1, 'rgb(212, 0, 0)');
		  	}

		  	return gradient;
		}

		let labels = [];
		let data = {
			labels: labels,
			datasets: [{
			label: 'Temperatures',
			borderColor: (context) => {
        			const chart = context.chart;
			        const {ctx, chartArea} = chart;

			        if (!chartArea) {
			          // This case happens on initial chart load
			          return null;
			        }

			        return getGradient(ctx, chartArea);
			},
			tension: 0.3,
			data: [],
			}]
		};

		const config = {
			type: 'line',
			data,
			options: {}
		}

		let chart = new Chart(
			document.getElementById('chart'),
			config
		);

		socket.on('web-data', (data) => {
			chart.data.labels.push(count++);
			chart.data.datasets.forEach((dataset) => {
				dataset.data.push(data);
			});
			chart.update();
		});
	</script>
{% endblock %}
